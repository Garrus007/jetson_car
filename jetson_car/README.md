# ROS jetson_car

Пакет ROS с основной функциональностью:
 
- управление двигателями 
- удаленное управление с помощью джойстика
- движение по заданной траектории

## motors\_driver\_node
Осуществляет управление двигателями. Принимает команды управления и передает их микроконтроллеру.

Принимаемые топики:

- `/motors_commands` (`jetson_car/MotorsControl`) - сырые команды управления двигателями (значение ШИМ для каждого двигателя)

## odometry_logger_node
Логгирует положение в файл, публикует пройденную траекторию

Принимаемые топики:
 
- `/zed/odom` (`nav_msgs/Odometry`) - одометрия

Публикуемые топики:

- `/real_path` (`nav_msgs/Path`) - путь, построенный на основе одометрии

## joy\_to\_motors\_node
Принимает сообщения от джойстика и преобразует их в сообщения для управления двигателями. Ось Y(1) - линейная скорось, ось Z(2) - вращение.

Принимаемые топики:

 - `/joy` (`sensor_msgs/Joy`) - команды управления от джойстика

Публикуемые топики:

 - `/motors_commands` (`jetson_car/MotorsControl`) - сырые команды для двигателей

Параметры:
 
 - `max_pwm` - значение ШИМ, соответствующее максимуму команды от джойстика. Команды в интервале [-1; 1]

## path\_pub\_node
Считывает траекторию из файла и публикует ее

Публикуемые топики:

- `\path` (`nav_msgs/Path`) - считанная траектория

Параметры:

 - `path_file` - путь к CSV файлу с траекторией


## path\_mover\_node
Осуществляет движение по заданной траектории

Принимаемые топики:
 
 - `\zed\odom` (`nav_msgs/Odometry`) - одометрия
 - `\path` (`nav_msgs/Path`) - желаемая траектория

Публикуемые топики:
 
 - `\joy` (`sensor_msgs/Joy`) - команды управлеия

*Ок, не лучший вариант, лучше использовать Twist, вместо joy*

## launch-файлы
### joystic.launch
Ручное управление с помощью джойстика + трансляция видео со встроенной CSI-камеры. Запускается на Jetson

Args
 
- max_pwm - максимальное значение ШИМ
- is_stream - включение видеотрансляции
- control_pc - адрес ПК, с которого идет управление (требуется для трансляции)
 
### joystick\_teleop.launch
Клиент управления с помощью джойстика. Запускается на ПК

Args:

 - dev - устройство джойстика (по-умолчанию `/dev/input/joy0`)
 
### path\_move.launch
Движение по траектории. Запускается на Jetson

Args:

 - max_pwm - максимальное значение ШИМ
 - run_now - запускать ноду движения. В противном случае будет запущен zed, `motors_driver_node`, `joy_to_motors_node`, а `path_mover_node` необходимо будет включить отдельно. Для удобства отладки
 
# path_move\_teleop.launch
Движение по траектории. Запускается на ПК. Публиекует выбранный файл траектории, логгирует одометрию в файл, отображает всё в RViz. Также запускает джойстик, чтобы можно было в случае чего избежать столкновений.

Args:

 - dev - устройство джойстика (по-умолчанию `/dev/input/joy0`)
 - is\_publish\_path - публиковать ли путь, построенный по одометрии (zed умеет делать это сам)
 - is\_log\_path - логгировать ли одометрию в файл
 - logs_directory - директория логов
 - path_file - путь к файлу траектории